---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# survtabler

<!-- badges: start -->
<!-- badges: end -->

`survival` package in R is great for interactively and flexibly running survival models and evaluate the resulting model. However, it does not "teach" any structure for an efficient workflow, and often leads to imperative programming and long and complicated analysis scripts. The aim of `survtabler` is to make survival analysis fast, concise, and intuitive while keeping the analysis code easy to read. This is achieved by *function-based* workflow, where many typical steps (modeling, graphing, analyses of violations of proportional hazards model) are automated with functions.

## Installation

You can install the development version of `survtabler` from [GitHub](https://github.com/) with:

```{r example_1}
# install.packages("devtools")
# devtools::install_github("jkoskenniemi/survtabler")
```

## Example

The first step is to plan and specify, which Survival models are analyzed. `create_survtable()` builds a data.frame that includes each combination of primary exposures of interest (specified in input as `expoure_vars`), outcomes (`outcome_vars`), follow-up time (`time_var`) and analysis data (`data`). Optionally, subgroup analyses can be requested by providing the variable and values that that define subgroup analyses (`submodel_var` and `submodel_values`).

```{r example_2}
library(survtabler)
library(magrittr)
library(dplyr)

#Specify all combinations of exposure, outcome, time variables and data_name
survtable_1 <- create_survtable(exposure_vars = c("exposure_2cat", "exposure_continuous"),
                 outcome_vars = c("outcome1", "outcome2"),
                 covariates = "age + sex + hla",
                 time_var = "cens_time",
                 data_name = "example_ti")
```


`survtable` includes for each row everything that is needed for survival analyses by `survival::coxph`: data (`data_name`) and model formula (`formula_str`).

```{r}
survtable_1 %>% select(data_name, formula_str)
```

After the `survtable` has been created, in principle the following steps (`model_survtable()`, `get_coefs()`, `graph_coefs()`, `get_model_metadata()`, `catch_nonph()`, can be automated and included in a single function (to be created). However, they are all are shown here to show the entire process.  

First, each models are fitted and returned as a list
```{r example_3}
models <- survtable_1 %>%  
  model_survtable()
```


And then model coefficients are extracted and a forest plot drawn, ...
```{r example_4}
models  %>%  
  get_coefs(c("exposure_2cat", "exposure_continuous"))  %>%  #Get coefficients for forrest plots
  graph_coefs(title = "**Your title here**") #Draw forest plots
```

... model metadata extracted, ...
```{r example_5}
models  %>%  
  get_model_meta()
```

... and finally models that violate proportionality of the hazards assumption can be caught (the following example has none).
```{r example_6}
models  %>%  
  catch_nonph()
```

